
# Test task
task :test => [:unit, :spec]

task :unit do
  Dir[File.dirname(File.absolute_path(__FILE__)) + '/**/*_test.rb'].each {|file| require file }
end

task :spec => [:setup] do
  # TODO: Spec tests
end

task :setup do
  require 'data_mapper'
  require_relative 'app/models/player'
  require_relative 'app/models/item'
  require_relative 'app/models/room'
  require_relative 'app/models/dungeon'

  DataMapper.setup(:default, 'mysql://gods:some_pass@localhost/WanderingGods')
  DataMapper.finalize
  DataMapper.auto_migrate!

  dungeon = Dungeon.first_or_create(:name => 'Eden', :author => '×™×”×•×”')
  room1 = Room.first_or_create(:name => 'Garden', :description => 'You are standing in a beautiful garden.')
  item = Item.first_or_create(:name => 'Thingy', :description => 'It\'s just a thingy.')
  room1.add_item(item)
  dungeon.set_first_room(room1)
end

task :default => [:test]